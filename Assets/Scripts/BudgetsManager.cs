using System.Collections;
using System.Collections.Generic;
using UnityEngine;


public class BudgetsManager : MonoBehaviour {

	[System.Serializable]
	public class BudgetCollection
	{
			public Budget[] budgets;
	}

	[System.Serializable]
	public class Budget {
		public string guid;
		public string user_guid;
		public string category_guid;
		public int amount;
		public double transaction_total;
		public string external_id;
		public int revision;
		public int start_date;
		public int end_date;
		public int created_at;
		public int updated_at;
		public int status_code;
		public string name;
		public bool is_off_track;
		public bool is_exceeded;
		public double projected_transaction_total;
		public double projected_transaction_total_ratio;
		public string top_level_category_guid;
		public bool is_income;
		public string external_guid;
		public string client_guid;
		public string parent_guid;
		public string metadata;
		public bool is_deleted;
		public int deleted_at;
	}

  public void Start () {
		_budgets = new List<Budget>();
		_sub_budgets = new SortedDictionary<string, List<Budget>>();

    Debug.Log("Loading Budgets");
    var collection = JsonUtility.FromJson<BudgetCollection>(_budgets_json);
		foreach (var b in collection.budgets) {
			  var budget = JsonUtility.FromJson<Budget>(JsonUtility.ToJson(b));
				if(budget.parent_guid.Length == 0) {
					_budgets.Add(budget);
				} else {
					string key = budget.parent_guid;
					if(!_sub_budgets.ContainsKey(key)) {
						_sub_budgets.Add(key, new List<Budget>());
					}
					_sub_budgets[key].Add(budget);
				}
		}
    Debug.Log("Loaded " + _budgets.Count + " Budgets");
  }

	public List<Budget> getBudgets() {
		return _budgets;
	}
	public List<Budget> getSubBudgets(string budget_guid) {
		return _sub_budgets[budget_guid];
	}

	protected List<Budget> _budgets; 															 // Top level budgets
	protected SortedDictionary<string, List<Budget>> _sub_budgets; // Sub-budgets based on budget guid

  private string _budgets_json = "{\"budgets\":[{\"id\":35,\"amount\":25,\"category_guid\":\"CAT-e5154228-fe45-790d-a280-f6bf5ae5ac9f\",\"created_at\":1536178438,\"guid\":\"BGT-b1371d60-1240-6bdf-eee0-07a478d2f94e\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Personal Care\",\"projected_transaction_total\":0,\"revision\":4,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":30,\"amount\":300,\"category_guid\":\"CAT-6c7de3f8-de6c-7061-1dd2-b093044014bf\",\"created_at\":1536178438,\"guid\":\"BGT-be88b724-d2c7-49cb-7187-ec5ae854e89c\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Financial\",\"projected_transaction_total\":0,\"revision\":11,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":29,\"amount\":16,\"category_guid\":\"CAT-7cccbafa-87d7-c9a6-661b-8b3402fe9e78\",\"created_at\":1536178438,\"guid\":\"BGT-1ca92073-9905-d927-dba2-406027a474a4\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Pets\",\"projected_transaction_total\":0,\"revision\":17,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":36,\"amount\":216,\"category_guid\":\"CAT-aad51b46-d6f7-3da5-fd6e-492328b3023f\",\"created_at\":1536178438,\"guid\":\"BGT-f485976b-8f82-b3dc-ba22-632a46780978\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Shopping\",\"projected_transaction_total\":0,\"revision\":5,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":28,\"amount\":6200,\"category_guid\":\"CAT-bf9f3294-4c40-1677-d269-54fbc189faf3\",\"created_at\":1536178438,\"guid\":\"BGT-ec67f11a-4ca4-83a2-4e51-f512308612f2\",\"is_exceeded\":false,\"is_income\":true,\"is_off_track\":false,\"name\":\"Income\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":32,\"amount\":160,\"category_guid\":\"CAT-8edf9663-623e-4735-490e-31288f0a70b0\",\"created_at\":1536178438,\"guid\":\"BGT-82f805b2-5186-db35-083e-364403465c2a\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Gifts & Donations\",\"projected_transaction_total\":0,\"revision\":5,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":27,\"amount\":35,\"category_guid\":\"CAT-cd9f9f60-622d-0488-d203-044c8726a7eb\",\"created_at\":1536178438,\"guid\":\"BGT-6ae1b959-3649-1bf3-f2a3-a1fb8c8870f6\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Gym\",\"parent_guid\":\"BGT-816a3b27-33b9-0e08-e442-fc26b3892b53\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":26,\"amount\":24,\"category_guid\":\"CAT-0cb1d99d-f558-99e3-2282-b31f359b411a\",\"created_at\":1536178438,\"guid\":\"BGT-d750d9da-4399-516d-9ab3-c8815c708a1f\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Kids\",\"projected_transaction_total\":0,\"revision\":8,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":25,\"amount\":380,\"category_guid\":\"CAT-79b02f2f-2adc-88f0-ac2b-4e71ead9cfc8\",\"created_at\":1536178438,\"guid\":\"BGT-ec781940-cee8-f293-edcb-0f03af39fc08\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Bills & Utilities\",\"projected_transaction_total\":84.502857,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":24,\"amount\":100,\"category_guid\":\"CAT-b4789667-6acc-a112-975e-15746003ed61\",\"created_at\":1536178438,\"guid\":\"BGT-91bbe30a-5c2a-6edc-50bf-cbd094f609c8\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Mobile Phone\",\"parent_guid\":\"BGT-ec781940-cee8-f293-edcb-0f03af39fc08\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":23,\"amount\":25,\"category_guid\":\"CAT-e04e9d1e-e041-c315-2e50-094143ab3f73\",\"created_at\":1536178438,\"guid\":\"BGT-a525c009-0054-bc29-cda4-576861a6bfe2\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Entertainment\",\"projected_transaction_total\":0,\"revision\":6,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":21,\"amount\":960,\"category_guid\":\"CAT-7829f71c-2e8c-afa5-2f55-fa3634b89874\",\"created_at\":1536178438,\"guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Auto & Transport\",\"projected_transaction_total\":0,\"revision\":3,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":33,\"amount\":100,\"category_guid\":\"CAT-006862be-64a0-e778-f035-0936445b9c16\",\"created_at\":1536178438,\"guid\":\"BGT-27339d5e-ca8f-03b2-69ee-e2c57dc77c71\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Restaurants\",\"parent_guid\":\"BGT-40b12f03-9655-f9ca-b8ed-ce7d66b00e4a\",\"projected_transaction_total\":30.58,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":1,\"amount\":50,\"category_guid\":\"CAT-726da718-d572-1e4d-7c3f-0b8b5370fe71\",\"created_at\":1536178437,\"guid\":\"BGT-35aab378-f5e7-7133-3449-49c3f7983af8\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Parking\",\"parent_guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"projected_transaction_total\":0,\"revision\":3,\"transaction_total\":0,\"updated_at\":1536178437},{\"id\":20,\"amount\":250,\"category_guid\":\"CAT-bf5c9cca-c96b-b50d-440d-38d9adfda5b0\",\"created_at\":1536178438,\"guid\":\"BGT-3376d4f5-e16c-9212-7d40-d6d0382ea5bf\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Education\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":19,\"amount\":253,\"category_guid\":\"CAT-ea23d844-cbd1-eb10-f6ac-0df9610e59ae\",\"created_at\":1536178438,\"guid\":\"BGT-4dd89d95-1831-b8b6-9bc4-f4ae8df7fd22\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Travel\",\"projected_transaction_total\":0,\"revision\":14,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":22,\"amount\":80,\"category_guid\":\"CAT-b316e683-c898-6497-a476-6bc48d12e51d\",\"created_at\":1536178438,\"guid\":\"BGT-44cc9c95-5d8b-aa9c-4cf8-7cb0cc7f6909\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Television\",\"parent_guid\":\"BGT-ec781940-cee8-f293-edcb-0f03af39fc08\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":18,\"amount\":650,\"category_guid\":\"CAT-bd56d35a-a9a7-6e10-66c1-5b9cc1b6c81a\",\"created_at\":1536178438,\"guid\":\"BGT-40b12f03-9655-f9ca-b8ed-ce7d66b00e4a\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Food & Dining\",\"projected_transaction_total\":359.0925,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":17,\"amount\":185,\"category_guid\":\"CAT-de7c2dc7-90e6-85a2-6509-5ec10942e887\",\"created_at\":1536178438,\"guid\":\"BGT-b464b287-064b-b97a-2b45-878cbed2d13d\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Auto Insurance\",\"parent_guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":13,\"amount\":50,\"category_guid\":\"CAT-67a20fb1-1a61-dc27-3fff-f28fa904025f\",\"created_at\":1536178438,\"guid\":\"BGT-4c4968cd-2db4-06df-fa1a-1524946d30be\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Service & Parts\",\"parent_guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":12,\"amount\":35,\"category_guid\":\"CAT-a5600b35-c9b1-347d-f678-781597851104\",\"created_at\":1536178438,\"guid\":\"BGT-9f04c01f-60b9-2865-0507-dc3b7a724e36\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Pharmacy\",\"parent_guid\":\"BGT-816a3b27-33b9-0e08-e442-fc26b3892b53\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":11,\"amount\":100,\"category_guid\":\"CAT-88cbb033-0fc1-ff06-6532-0f357c0f5081\",\"created_at\":1536178438,\"guid\":\"BGT-5bbca83e-2bc4-3e34-bb7b-017e48ab5736\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Fast Food\",\"parent_guid\":\"BGT-40b12f03-9655-f9ca-b8ed-ce7d66b00e4a\",\"projected_transaction_total\":26.172857,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":14,\"amount\":300,\"category_guid\":\"CAT-b6d63a19-30a7-e852-2703-bdfb4072289e\",\"created_at\":1536178438,\"guid\":\"BGT-08b6211f-f5be-06bc-ca79-bf8e467dc690\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Gas\",\"parent_guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"projected_transaction_total\":76.431111,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":10,\"amount\":375,\"category_guid\":\"CAT-cb93691a-684d-b326-4c32-f8abaecfde90\",\"created_at\":1536178438,\"guid\":\"BGT-1be06b59-ea63-ee04-9b56-edffd0db6e2e\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Auto Payment\",\"parent_guid\":\"BGT-1e3a0557-2909-901e-d7d7-7576cf9aa32e\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":8,\"amount\":250,\"category_guid\":\"CAT-2ce4972e-5620-57be-8475-d084edf88888\",\"created_at\":1536178438,\"guid\":\"BGT-1a698b7f-299b-6f47-4353-7b5b9fd8a602\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Student Loan\",\"parent_guid\":\"BGT-3376d4f5-e16c-9212-7d40-d6d0382ea5bf\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":16,\"amount\":205,\"category_guid\":\"CAT-8faa2a11-f393-9c13-2885-e7d11fa6a51a\",\"created_at\":1536178438,\"guid\":\"BGT-9310065f-75f0-03a9-0d3f-c41ca60571e4\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Health Insurance\",\"parent_guid\":\"BGT-816a3b27-33b9-0e08-e442-fc26b3892b53\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":15,\"amount\":50,\"category_guid\":\"CAT-ddc9b8e0-a9a1-e31e-a467-2c33e553afd9\",\"created_at\":1536178438,\"guid\":\"BGT-622a29ef-d6c2-ccdd-b6c0-494b0ee1f95f\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Home Improvement\",\"parent_guid\":\"BGT-204b9ccf-4420-164d-66f8-77e964f81774\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":9,\"amount\":200,\"category_guid\":\"CAT-56a2979d-d6df-25da-f357-06282f08208e\",\"created_at\":1536178438,\"guid\":\"BGT-cb27eaab-e6a5-c901-831f-6b50476b562d\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Utilities\",\"parent_guid\":\"BGT-ec781940-cee8-f293-edcb-0f03af39fc08\",\"projected_transaction_total\":69.905,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":34,\"amount\":1474,\"category_guid\":\"CAT-b709172b-4eb7-318e-3b5d-e0f0500b32ac\",\"created_at\":1536178438,\"guid\":\"BGT-204b9ccf-4420-164d-66f8-77e964f81774\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Home\",\"projected_transaction_total\":0,\"revision\":3,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":7,\"amount\":35,\"category_guid\":\"CAT-2910e436-7fed-f922-184c-60bc1b6c5417\",\"created_at\":1536178438,\"guid\":\"BGT-1f4dfe7e-d74e-c0dd-62fa-21aec4d6721c\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Furnishings\",\"parent_guid\":\"BGT-204b9ccf-4420-164d-66f8-77e964f81774\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":5,\"amount\":1388,\"category_guid\":\"CAT-23b4b4c6-5fbb-9299-b887-4b56196e6fb4\",\"created_at\":1536178438,\"guid\":\"BGT-3e441150-acc7-cb8a-9995-df754b8010ad\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Mortgage & Rent\",\"parent_guid\":\"BGT-204b9ccf-4420-164d-66f8-77e964f81774\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":6,\"amount\":450,\"category_guid\":\"CAT-b1de2a04-db08-b6ed-f6fe-ca2f5b11c2d0\",\"created_at\":1536178438,\"guid\":\"BGT-cb39db8c-b16b-6933-3d6a-a2019a8e2d4a\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Groceries\",\"parent_guid\":\"BGT-40b12f03-9655-f9ca-b8ed-ce7d66b00e4a\",\"projected_transaction_total\":278.934118,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":2,\"amount\":0,\"category_guid\":\"CAT-1550a06e-f929-e8b7-5495-24fb3e9df4f6\",\"created_at\":1536178438,\"guid\":\"BGT-6637ba71-ba23-a2c6-2665-b7c0a59f2ab3\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"test\",\"parent_guid\":\"BGT-f485976b-8f82-b3dc-ba22-632a46780978\",\"projected_transaction_total\":0,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":4,\"amount\":4,\"category_guid\":\"CAT-94b11142-e97b-941a-f67f-6e18d246a23f\",\"created_at\":1536178438,\"guid\":\"BGT-73dd59cc-c62a-fd04-4052-58cf792ac4c1\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Business Services\",\"projected_transaction_total\":0,\"revision\":3,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":31,\"amount\":275,\"category_guid\":\"CAT-52fa4693-c088-afb2-2a99-7bc39bb23a0f\",\"created_at\":1536178438,\"guid\":\"BGT-816a3b27-33b9-0e08-e442-fc26b3892b53\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Health & Fitness\",\"projected_transaction_total\":180.453333,\"revision\":1,\"transaction_total\":0,\"updated_at\":1536178438},{\"id\":3,\"amount\":39,\"category_guid\":\"CAT-d73ee74b-13a4-ac3e-4015-fc4ba9a62b2a\",\"created_at\":1536178438,\"guid\":\"BGT-da5999a9-693f-4d0d-7ef9-1e440929d333\",\"is_exceeded\":false,\"is_income\":false,\"is_off_track\":false,\"name\":\"Fees & Charges\",\"projected_transaction_total\":0,\"revision\":3,\"transaction_total\":0,\"updated_at\":1536178438}]}";
}
